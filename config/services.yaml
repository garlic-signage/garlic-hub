# This file is the entry point to configure your own services.
# Files in the packages/ subdirectory configure your dependencies.

# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
parameters:
    app.name: 'garlic-hub - Digital Signage Management Platform'
    platform_edition: '%env(APP_PLATFORM_EDITION)%'

    database_config:
        db_path: '%kernel.project_dir%/var/garlic-hub.sqlite'
        db_user: '%env(DB_MASTER_USER)%'
        db_pass: '%env(DB_MASTER_PASSWORD)%'
        db_name: '%env(DB_MASTER_NAME)%'
        db_host: '%env(DB_MASTER_HOST)%'
        db_driver: '%env(DB_MASTER_DRIVER)%'
        db_port: '%env(DB_MASTER_PORT)%'

imports:
    - { resource: 'services/edge.yaml', when: 'env(APP_PLATFORM_EDITION) == edge' }
    - { resource: 'services/core.yaml', when: 'env(APP_PLATFORM_EDITION) == core' }
    - { resource: 'services/enterprise.yaml', when: 'env(APP_PLATFORM_EDITION) == full' }

services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
        autoconfigure: true # Automatically registers your services as commands, event subscribers, etc.


    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'

    # add more service definitions when explicit configuration is needed
    # please note that last definitions always *replace* previous ones

    App\Framework\Database\Adapters\AdapterInterface:
        alias: 'App\Framework\Database\DBHandler'

    App\Framework\Database\DBHandler:
        factory: [ 'App\Framework\Database\Adapters\Factory', 'createConnection' ]
        arguments:
            - '%database_config%'

    App\Framework\Database\QueryBuilder:
        autowire: true
        autoconfigure: true

    App\Framework\Database\Migration\MigrateDatabase:
        arguments:
            $dbh: '@App\Framework\Database\DBHandler'
            $queryBuilder: '@App\Framework\Database\QueryBuilder'
        lazy: true

    App\Command\MigrateDatabaseCommand:
        arguments:
            $DatabaseMigration: '@App\Framework\Database\Migration\MigrateDatabase'
            $kernel: '@kernel'
            $params: '@parameter_bag'


    App\EventSubscriber\LocaleSubscriber:
        arguments:
            $requestStack: '@request_stack'
        tags:
            - { name: kernel.event_subscriber }


    App\Services\PerformanceMonitor: ~
    App\Twig\PerformanceExtension:
        tags: ['twig.extension']


    App\Modules\Auth\Repository\UserMainDataPreparer:
        autowire: true
        autoconfigure: true

    App\Modules\Auth\Repository\UserMain:
        arguments:
            $dbh: '@App\Framework\Database\DBHandler'
            $queryBuilder: '@App\Framework\Database\QueryBuilder'
            $dataPreparer: '@App\Modules\Auth\Repository\UserMainDataPreparer'
            $table: 'user_main' # Setze den gew√ºnschten Tabellennamen
            $id_field: 'UID'    # Setze auch das ID-Feld, falls erforderlich
        autowire: true
        autoconfigure: true
